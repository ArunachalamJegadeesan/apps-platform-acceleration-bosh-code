---
name: articulate

director_uuid: <%= `bosh status --uuid` %>

releases:
  - name: articulate
    version: latest
  - name: redis
    version: latest

instance_groups:
  - name: articulate
    instances: 1
    resource_pool: articulate
    networks:
      - name: articulate
        static_ips: [10.244.9.5]
    jobs:
      - release: articulate
        name: articulate
        properties:
          port: 9000

  - name: redis_leader_z1
    instances: 1
    resource_pool: redis
    persistent_disk: 4096
    networks:
      - name: redis
        static_ips:
        - 10.244.2.2
    jobs:
      - release: redis
        name: redis
        properties:
          redis:
            password: red!s

  - name: redis_z1
    instances: 2
    resource_pool: redis
    persistent_disk: 4096
    networks:
      - name: redis
    update:
      canaries: 10
    jobs:
      - release: redis
        name: redis
        properties:
          redis:
            master: 10.244.2.2
            password: red!s

  - name: redis_test_slave_z1
    instances: 1
    resource_pool: redis
    persistent_disk: 4096
    networks:
      - name: redis
        static_ips:
        - 10.244.2.6
    jobs:
      - release: redis
        name: redis
        properties:
          redis:
            master: 10.244.2.2
            password: red!s

  - name: acceptance-tests
    instances: 1
    lifecycle: errand
    resource_pool: redis
    networks:
      - name: redis
    jobs:
      - release: redis
        name: acceptance-tests
        properties:
          redis:
            master: 10.244.2.2
            password: red!s
            slave: 10.244.2.6

update:
  canaries: 1
  max_in_flight: 3
  serial: false
  canary_watch_time: 1000-60000
  update_watch_time: 1000-60000
